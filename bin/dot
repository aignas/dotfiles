#!/usr/bin/env bash

print_help(){
  cat <<EOF
dot -- dotfiles management

Usage: dot [options]

Default is to update the dotfiles and setup the system for work.

Options:
 -e, --edit   Open dotfiles directory for editing
 -l, --lint   Lint dotfiles
 -h, --help   Show this help message and exti
EOF
}

while test $# -gt 0; do
  case "$1" in
    "-h"|"--help") print_help;;
    "-e"|"--edit") exec e "${DOTFILES}";;
    "-l"|"--lint") exec "${DOTFILES}/script/lint";;
    *) echo "Invalid option: $1"; print_help; exit 1;;
  esac
  exit 0
  shift
done

# Update
if [[ -n "$(git -C "${DOTFILES}" diff)" ]]
then
  echo "Commit the changes and try again."
  exit 1
fi

git -C "${DOTFILES}" pull --rebase
git -C "${DOTFILES}" submodule update --recursive
git -C "${DOTFILES}" push
"${DOTFILES}/script/bootstrap" --overwrite
