#!/bin/bash

main() {
  local targets prefix
  case $1 in
    t|tag)
      prefix=tag
      targets=$(git tag || return)
      ;;
    ''|b|branch)
      prefix=branch
      targets=$(git branch --all |
        grep -v HEAD |
        sed "s/.* //" |
        sed "s#remotes/[^/]*/##" || return)
      ;;
    h|help|*)
      cat <<EOF
Interactive browsing of revisions

Subcommands:
 [|b|branch]: branch
 [t|tag]: tag
 [c|commit]: commit TBD
EOF
      ;;
  esac
  [[ -z ${targets} ]] && return
  target=$(echo "$targets" |
    sort -u |
    awk -v prefix="$prefix" '{print "\x1b[31;1m" prefix "\x1b[m\t" $1}' |
    sk --no-hscroll --ansi -d "\t" -n 2) || return
  echo "$target" | awk '{print $2}'
}

main "$@"
