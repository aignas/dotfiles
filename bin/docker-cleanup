#!/bin/bash

echo removing exited containers...
docker ps --filter status=dead --filter status=exited -aq |
    xargs -L 1 docker rm -v

echo removing unused images...
docker images --no-trunc |
    grep '<none>' |
    awk '{ print $3 }' |
    xargs -L 1 docker rmi

echo removing unused volumes...
find '/var/lib/docker/volumes/' -mindepth 1 -maxdepth 1 -type d |
    grep -vFf <(
        docker ps -aq |
            xargs docker inspect |
            jq -r '.[] | .Mounts | .[] | .Name | select(.)'
    ) |
    xargs -L 1 rm -fr
