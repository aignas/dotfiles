#!/bin/bash

set -oe pipefail

lintsh() {
  echo -e "\nlinting $1 files:"
  files=$(rg -l --no-ignore "^#!.*/$1" ||
    grep -rl --exclude-dir=.git "^#\!.*/$1" . || (
      echo "failed to get files" && exit 1))
  echo "${files}"
  echo "${files}" | xargs shellcheck
}

lintvim() {
  [[ -f "$(command -v vint)" ]] || \
    python3 -m venv /tmp/vint && \
    /tmp/vint/bin/pip install --upgrade setuptools pip vim-vint pathlib typing

  echo -e "\nlinting vim files:"
  files=$(fd -e vim ||
    find . -name "*\.vim" || (
      echo "failed to get files" && exit 1))
  echo "${files}"
  echo "${files}" | xargs /tmp/vint/bin/vint "$@"
}

case "${LINT:-all}" in
  "vint")
      lintvim
      ;;
  "vint-errors")
      lintvim --error
      ;;
  "shellcheck")
      lintsh sh
      lintsh bash
    ;;
  *)
      lintsh sh
      lintsh bash
      lintvim --error
    ;;
esac
